app: gvim
binpatch: true

ingredients:
  package: vim-gtk
  dist:    trusty
  sources:
    - deb http://archive.ubuntu.com/ubuntu/ trusty main restricted
    - deb http://archive.ubuntu.com/ubuntu/ trusty universe
    - deb http://archive.ubuntu.com/ubuntu/ trusty-updates main restricted
    - deb http://archive.ubuntu.com/ubuntu/ trusty-updates universe
    - deb http://archive.ubuntu.com/ubuntu/ trusty-security main restricted
    - deb http://archive.ubuntu.com/ubuntu/ trusty-security universe
  ppas:
    - jonathonf/vim

script:
  - VERSION=$(ls ../vim-gtk*.deb | cut -d '-' -f 2 | sed -e 's|.deb||g' | sed -e 's/gtk_//g')
  - cp "../vim-gtk_${VERSION}-0york1~14.04_amd64.deb" "../gvim_${VERSION}_amd64.deb"
  # Needed due to missing icon file for gvim
  - cp ./usr/share/icons/hicolor/scalable/apps/gvim.svg .
  # Needed due to missing gvim binary that is mentioned in gvim.desktop file
  - cd ./usr/bin
  - ln -sf vim.gtk gvim
  - cd -
  - cp ./usr/share/applications/gvim.desktop gvim.desktop
  - sed -i -e 's/Name=GVim/Name=gvim/g' gvim.desktop
